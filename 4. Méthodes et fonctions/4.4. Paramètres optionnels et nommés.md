# 4.4. Paramètres optionnels et nommés

Les paramètres optionnels et nommés sont des fonctionnalités puissantes introduites dans C# 4.0, disponibles à la fois dans .NET Framework 4.7.2 et .NET 8. Ces fonctionnalités offrent plus de flexibilité lors de la conception et de l'appel des méthodes, améliorant la lisibilité du code et réduisant le besoin de surcharges multiples. Dans cette section, nous allons explorer en détail comment utiliser ces fonctionnalités.

## 4.4.1. Valeurs par défaut

Les paramètres optionnels permettent de définir des valeurs par défaut pour les paramètres d'une méthode, rendant ces paramètres facultatifs lors de l'appel.

### Syntaxe de base

```textmate
public void MaMethode(int paramètreObligatoire, string paramètreOptionnel = "valeur par défaut")
{
    // Corps de la méthode
}
```


### Types de valeurs par défaut autorisées

Les valeurs par défaut pour les paramètres optionnels doivent être :
- Des constantes (comme des littéraux de chaîne, des nombres, etc.)
- Une expression `default(T)`
- Une expression `new SomeStruct()`
- Une référence de constante

```textmate
// Exemples de valeurs par défaut valides
public void ConfigurerOptions(
    string nom,                             // Paramètre obligatoire
    int priorité = 0,                       // Valeur numérique par défaut
    string description = null,              // null comme valeur par défaut
    bool estActif = true,                   // Booléen par défaut
    ConsoleColor couleur = ConsoleColor.Gray, // Valeur d'énumération par défaut
    LogLevel niveau = default(LogLevel),    // Utilisation de default
    TimeSpan délai = default,               // Utilisation de default implicite (.NET 8)
    DateTime? dateExpiration = null         // Type nullable avec null par défaut
)
{
    // Implémentation
}
```


### Restrictions importantes

1. **Position** : Les paramètres optionnels doivent apparaître après tous les paramètres obligatoires
2. **Constantes uniquement** : Les valeurs par défaut doivent être connues au moment de la compilation
3. **Paramètre params** : S'il est présent, doit apparaître après tous les paramètres optionnels

```textmate
// CORRECT : Paramètres optionnels après les paramètres obligatoires
public void Exemple1(int obligatoire, string optionnel = "défaut") { }

// INCORRECT : Paramètre obligatoire après un paramètre optionnel
// public void Exemple2(int optionnel = 0, string obligatoire) { }

// CORRECT : Plusieurs paramètres optionnels
public void Exemple3(int obligatoire, string opt1 = null, bool opt2 = false) { }

// CORRECT : Paramètre params après paramètres optionnels
public void Exemple4(int obligatoire, string optionnel = "défaut", params int[] valeurs) { }
```


### Limitations des valeurs non constantes

Les expressions non constantes ne sont pas autorisées comme valeurs par défaut :

```textmate
// INCORRECT : DateTime.Now n'est pas une constante
// public void Exemple(DateTime dateCreation = DateTime.Now) { }

// CORRECT : Utiliser une valeur par défaut constante
public void Exemple(DateTime dateCreation = default)
{
    if (dateCreation == default)
    {
        dateCreation = DateTime.Now;
    }
}

// Alternative : Utiliser une surcharge
public void Exemple()
{
    Exemple(DateTime.Now);
}

public void Exemple(DateTime dateCreation)
{
    // Implémentation
}
```


### Utilisation pratique dans différents contextes

#### Constructeurs avec paramètres optionnels

```textmate
public class Configuration
{
    public string Nom { get; }
    public int Priorité { get; }
    public bool EstActif { get; }

    public Configuration(string nom, int priorité = 0, bool estActif = true)
    {
        Nom = nom;
        Priorité = priorité;
        EstActif = estActif;
    }
}

// Utilisation
var config1 = new Configuration("Défaut");
var config2 = new Configuration("Important", 10);
var config3 = new Configuration("Spécial", 5, false);
```


#### Méthodes d'API avec options multiples

```textmate
public HttpClient CreateClient(
    string baseUrl,
    int timeoutSeconds = 30,
    bool useCompression = true,
    string authToken = null)
{
    var client = new HttpClient();
    client.BaseAddress = new Uri(baseUrl);
    client.Timeout = TimeSpan.FromSeconds(timeoutSeconds);

    if (useCompression)
    {
        client.DefaultRequestHeaders.AcceptEncoding.Add(
            new StringWithQualityHeaderValue("gzip"));
    }

    if (!string.IsNullOrEmpty(authToken))
    {
        client.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", authToken);
    }

    return client;
}

// Utilisation
var client1 = CreateClient("https://api.exemple.com");
var client2 = CreateClient("https://api.exemple.com", 60);
var client3 = CreateClient("https://api.exemple.com", 60, false);
```


#### Méthodes de formatage

```textmate
public string FormatMontant(
    decimal montant,
    string devise = "EUR",
    int décimales = 2,
    bool inclureSymbole = true)
{
    string format = inclureSymbole
        ? $"{{0:F{décimales}}} {devise}"
        : $"{{0:F{décimales}}}";

    return string.Format(format, montant);
}

// Utilisation
Console.WriteLine(FormatMontant(1234.56m));                 // "1234,56 EUR"
Console.WriteLine(FormatMontant(1234.56m, "USD"));          // "1234,56 USD"
Console.WriteLine(FormatMontant(1234.56m, "JPY", 0));       // "1235 JPY"
Console.WriteLine(FormatMontant(1234.56m, "EUR", 2, false)); // "1234,56"
```


### Compatibilité .NET Framework 4.7.2 et .NET 8

Les paramètres optionnels fonctionnent de manière identique dans .NET Framework 4.7.2 et .NET 8. Cependant, .NET 8 offre des types supplémentaires et des fonctionnalités qui peuvent être utilisés avec des paramètres optionnels.

## 4.4.2. Ordre d'appel avec paramètres nommés

Les paramètres nommés permettent de spécifier les arguments d'un appel de méthode en utilisant le nom du paramètre, plutôt que de se fier uniquement à la position.

### Syntaxe de base

```textmate
// Définition de la méthode
public void ConfigurerUtilisateur(string nom, int âge, bool estActif)
{
    // Implémentation
}

// Appel avec paramètres nommés
ConfigurerUtilisateur(nom: "Alice", âge: 30, estActif: true);

// Les paramètres nommés peuvent être dans n'importe quel ordre
ConfigurerUtilisateur(estActif: true, nom: "Bob", âge: 25);
```


### Combinaison de paramètres positionnels et nommés

Les paramètres positionnels et nommés peuvent être combinés, mais avec des règles importantes à respecter :

1. Les paramètres positionnels doivent apparaître avant les paramètres nommés
2. Les paramètres positionnels sont mappés dans l'ordre de la signature de la méthode
3. Les paramètres nommés peuvent apparaître dans n'importe quel ordre après les paramètres positionnels

```textmate
// Définition
public void Exemple(int a, string b, bool c, double d)
{
    Console.WriteLine($"a={a}, b={b}, c={c}, d={d}");
}

// Appels valides
Exemple(1, "texte", true, 3.14);                // Tous positionnels
Exemple(1, "texte", c: true, d: 3.14);          // Mélange, mais les nommés à la fin
Exemple(1, b: "texte", c: true, d: 3.14);       // Premier positionnel, reste nommé
Exemple(a: 1, b: "texte", c: true, d: 3.14);    // Tous nommés

// Appels INVALIDES
// Exemple(a: 1, "texte", true, 3.14);          // Erreur: positionnels après nommés
// Exemple(1, b: "texte", true, d: 3.14);       // Erreur: positionnel après nommé
```


### Cas d'utilisation pratiques

#### Amélioration de la lisibilité pour les paramètres multiples

```textmate
// Sans paramètres nommés
DrawRectangle(10, 20, 100, 50, 2, Color.Red, true, false);

// Avec paramètres nommés - beaucoup plus clair
DrawRectangle(
    x: 10,
    y: 20,
    width: 100,
    height: 50,
    borderWidth: 2,
    borderColor: Color.Red,
    isFilled: true,
    hasShadow: false
);
```


#### Arguments dans un ordre différent

```textmate
public void RechercherUtilisateurs(
    string nomUtilisateur = null,
    int? âgeMinimum = null,
    int? âgeMaximum = null,
    bool? estActif = null,
    string ville = null,
    DateTime? dateInscriptionMinimum = null)
{
    // Implémentation
}

// Recherche par ville et statut uniquement
RechercherUtilisateurs(
    ville: "Paris",
    estActif: true
);

// Recherche par tranche d'âge uniquement
RechercherUtilisateurs(
    âgeMinimum: 18,
    âgeMaximum: 30
);
```


#### Clarification des valeurs booléennes

Les paramètres nommés sont particulièrement utiles pour les méthodes avec plusieurs paramètres booléens :

```textmate
// Sans paramètres nommés - difficile à comprendre
ExporterDonnées("rapport.xlsx", true, false, true);

// Avec paramètres nommés - clair et explicite
ExporterDonnées(
    cheminFichier: "rapport.xlsx",
    inclureEntêtes: true,
    formatterPourImpression: false,
    chiffrerContenu: true
);
```


### Paramètres nommés et optionnels ensemble

La combinaison des paramètres nommés et optionnels offre une grande flexibilité et lisibilité :

```textmate
public void ConfigurerApplication(
    string nom,
    string répertoireDonnées = null,
    int portServeur = 8080,
    bool journalisationDétaillée = false,
    int délaiTimeoutSeconds = 30,
    string[] modulesOptionnels = null)
{
    // Implémentation
}

// Possibilités d'appel
ConfigurerApplication("MonApp");

ConfigurerApplication(
    nom: "MonApp",
    portServeur: 9000
);

ConfigurerApplication(
    nom: "MonApp",
    journalisationDétaillée: true,
    modulesOptionnels: new[] { "Rapports", "Statistiques" }
);
```


### Compatibilité et évolution d'API

Les paramètres nommés et optionnels facilitent l'évolution des APIs tout en maintenant la compatibilité :

```textmate
// Version 1.0 de l'API
public void ProcessData(string input, bool validate = true)
{
    // Implémentation
}

// Version 2.0 - Ajout de nouveaux paramètres sans casser le code existant
public void ProcessData(
    string input,
    bool validate = true,
    int priority = 0,         // Nouveau paramètre
    string outputFormat = null // Nouveau paramètre
)
{
    // Nouvelle implémentation
}

// Le code client existant continue de fonctionner
ProcessData("données");

// Nouveau code client peut utiliser les nouveaux paramètres
ProcessData("données", outputFormat: "JSON");
```


### Bonnes pratiques

#### 1. Choisir des noms de paramètres significatifs

Puisque les noms des paramètres font partie de l'API publique lors de l'utilisation de paramètres nommés, ils doivent être clairs et descriptifs.

```textmate
// Mauvais exemple
public void Configure(string s, int n, bool b) { }

// Bon exemple
public void Configure(string serverName, int maxConnections, bool enableLogging) { }
```


#### 2. Éviter d'avoir trop de paramètres optionnels

Un grand nombre de paramètres optionnels peut indiquer qu'une classe d'options dédiée serait plus appropriée.

```textmate
// Trop de paramètres optionnels
public void ConfigurationComplexe(
    string nom,
    string serveur = "localhost",
    int port = 8080,
    string utilisateur = null,
    string motDePasse = null,
    bool ssl = false,
    int timeout = 30,
    bool compression = true,
    int niveauCache = 2,
    bool journalisation = false,
    string formatJournal = "standard",
    // etc...
) { }

// Meilleure approche avec une classe d'options
public class OptionsConfiguration
{
    public string Serveur { get; set; } = "localhost";
    public int Port { get; set; } = 8080;
    public string Utilisateur { get; set; }
    public string MotDePasse { get; set; }
    public bool SSL { get; set; } = false;
    public int Timeout { get; set; } = 30;
    public bool Compression { get; set; } = true;
    public int NiveauCache { get; set; } = 2;
    public bool Journalisation { get; set; } = false;
    public string FormatJournal { get; set; } = "standard";
}

public void ConfigurationAvecOptions(string nom, OptionsConfiguration options = null)
{
    options ??= new OptionsConfiguration();
    // Implémentation
}
```


#### 3. Documentation des paramètres optionnels

Documentez clairement la signification des valeurs par défaut et les conditions dans lesquelles elles sont modifiées.

```textmate
/// <summary>
/// Configure les options de connexion à la base de données.
/// </summary>
/// <param name="connectionString">Chaîne de connexion à la base de données.</param>
/// <param name="timeout">
/// Délai d'expiration en secondes pour les requêtes.
/// La valeur par défaut (30) est adaptée pour des requêtes standard.
/// Pour des requêtes complexes, envisagez d'augmenter cette valeur.
/// </param>
/// <param name="retryCount">
/// Nombre de tentatives en cas d'échec.
/// Si défini à 0, aucune nouvelle tentative ne sera effectuée.
/// </param>
public void ConfigureDatabase(
    string connectionString,
    int timeout = 30,
    int retryCount = 3)
{
    // Implémentation
}
```


#### 4. Attention à la surcharge et aux paramètres optionnels

La combinaison de surcharges et de paramètres optionnels peut créer des ambiguïtés :

```textmate
// Potentiellement problématique
public void Méthode(int a, int b = 0) { }
public void Méthode(int a, string s = null) { }

// Appel potentiellement ambigu
Méthode(10); // Quelle surcharge sera appelée?
```


#### 5. Considérations pour les bibliothèques publiques

Pour les bibliothèques publiques utilisées par d'autres développeurs :

```textmate
// Attention aux modifications des valeurs par défaut dans les futures versions
public class Configuration
{
    // Version 1.0
    public void Configurer(bool enableCache = true) { }

    // Version 2.0 - Changer la valeur par défaut pourrait affecter
    // le comportement du code existant de manière subtile
    // public void Configurer(bool enableCache = false) { }

    // Meilleure approche pour une modification dans la version 2.0
    public void Configurer(bool enableCache = true, CacheOptions options = null)
    {
        options ??= new CacheOptions();
        // Nouvelle implémentation
    }
}
```


### Différences entre .NET Framework 4.7.2 et .NET 8

Les fonctionnalités de base des paramètres optionnels et nommés sont identiques entre .NET Framework 4.7.2 et .NET 8. Cependant, .NET 8 offre quelques améliorations et possibilités supplémentaires :

#### 1. Utilisation avec les nouvelles fonctionnalités du langage

Dans .NET 8, vous pouvez combiner les paramètres optionnels avec des fonctionnalités plus récentes du langage C# :

```textmate
// .NET 8 - Combinaison avec les propriétés d'expressions
public void Configurer(string nom, Action<ConfigOptions> configurer = null)
{
    var options = new ConfigOptions();
    configurer?.Invoke(options);

    // Utilisation des options
}

// Utilisation avec expression lambda
Configurer("MonApp", options => {
    options.Port = 8080;
    options.UseSsl = true;
});

// .NET 8 - Utilisation avec les records et l'initialisation des propriétés
public void ProcessData(
    string input,
    DataProcessingOptions options = null)
{
    options ??= new();
    // Traitement
}

// Appel avec initialisation de propriété
ProcessData("données", new DataProcessingOptions
{
    Validate = true,
    MaxItems = 100
});
```


#### 2. Performance améliorée

.NET 8 offre des optimisations de performance pour les appels de méthodes, y compris ceux utilisant des paramètres optionnels et nommés.

## Résumé

Les paramètres optionnels et nommés sont des fonctionnalités puissantes disponibles aussi bien dans .NET Framework 4.7.2 que dans .NET 8. Ils offrent plusieurs avantages :

- Réduction du nombre de surcharges nécessaires
- Amélioration de la lisibilité du code, particulièrement pour les méthodes avec de nombreux paramètres
- Flexibilité pour les appelants de spécifier uniquement les paramètres pertinents
- Facilitation de l'évolution des APIs au fil du temps

En suivant les bonnes pratiques et en comprenant les règles de combinaison et d'ordre des paramètres, vous pouvez créer des APIs intuitives et faciles à utiliser, tout en maintenant la compatibilité entre différentes versions de votre code.
